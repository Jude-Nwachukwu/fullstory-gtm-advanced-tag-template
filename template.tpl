___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Fullstory Advanced Unofficial",
  "brand": {
    "id": "brand_dummy",
    "displayName": "DumbData",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "This tag is used to implement Fullstory event tracking, user identification, set user property and set page properties.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "fsTagType",
    "displayName": "Tracking Tag Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "fsEventTracking",
        "displayValue": "Event Tracking"
      },
      {
        "value": "fsIdentify",
        "displayValue": "User Identification"
      },
      {
        "value": "fsSetPageProperties",
        "displayValue": "Set Page Properties"
      },
      {
        "value": "fsSetUserProperties",
        "displayValue": "Set User Properties"
      }
    ],
    "simpleValueType": true,
    "help": "Select the Fullstory tag type."
  },
  {
    "type": "GROUP",
    "name": "fsEventTrackingConfig",
    "displayName": "Fullstory Event Configuration",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "fsEventName",
        "displayName": "Fullstory Event Name",
        "simpleValueType": true,
        "help": "Enter the Fullstory event name.",
        "valueHint": "e.g., Viewed Product",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "fsEventPropValue",
        "displayName": "Add Fullstory Event Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Fullstory Property Key",
            "name": "fsEventPropertyKey",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "e.g.,  productId"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "fsEventPropertyValue",
            "type": "TEXT",
            "selectItems": [],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "e.g.,  {{dlv - item_id}}"
          }
        ],
        "newRowButtonText": "Add Event Property"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "fsTagType",
        "paramValue": "fsEventTracking",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "fsIdentifyMethodConfig",
    "displayName": "Visitor Profile Customization",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "fsUserIdSource",
        "displayName": "Fullstory User ID",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "help": "Select the variable that holds the user ID to be sent to Fullstory.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "fsUserIdCustomizer",
        "displayName": "Add Additional User Metadata",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Identifier Type",
            "name": "fsIdentifierType",
            "type": "TEXT",
            "selectItems": [
              {
                "value": "fsUserName",
                "displayValue": "Name"
              },
              {
                "value": "fsUserEmail",
                "displayValue": "Email"
              },
              {
                "value": "fsUserPhone",
                "displayValue": "Phone"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "e.g., Email"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "fsUserMetaDataValue",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "e.g., {{ dlv - email}}"
          }
        ],
        "newRowButtonText": "Add User Property"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "fsTagType",
        "paramValue": "fsIdentify",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "fsSetPageProperties",
    "displayName": "Fullstory Page Properties Configuration",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "fsPagePropertyValue",
        "displayName": "Add Fullstory Page Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Key",
            "name": "fsPagePropKey",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "e.g, pageName"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "fsPagePropValue",
            "type": "TEXT",
            "selectItems": [],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "e.g, {{ dlv - page title}}"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "newRowButtonText": "Add Page Property"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "fsTagType",
        "paramValue": "fsSetPageProperties",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "fsSetUserProperties",
    "displayName": "Fullstory User Properties Configuration",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "fsUserPropertyValue",
        "displayName": "Add Fullstory User Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "User Property Key",
            "name": "fsSetUserPropKey",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "e.g, account_plan"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "fsSetUserPropValue",
            "type": "TEXT",
            "selectItems": [],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "e.g, {{ dlv - plan type}}"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "newRowButtonText": "Add User Property"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "fsTagType",
        "paramValue": "fsSetUserProperties",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "group1",
    "displayName": "➡️ Link To Fullstory Documentation",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "LABEL",
        "name": "fsDocUserIdentify",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://developer.fullstory.com/browser/identification/identify-users/\"\u003e👤 User Identify Documentation Link\u003c/a\u003e\u003c/strong\u003e",
        "enablingConditions": [
          {
            "paramName": "fsTagType",
            "paramValue": "fsIdentify",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "fsDocEvent",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://help.fullstory.com/hc/en-us/articles/360020623274-Sending-custom-event-data-into-Fullstory\"\u003e✅ Purchase Event Documentation Link\u003c/a\u003e\u003c/strong\u003e",
        "enablingConditions": [
          {
            "paramName": "fsTagType",
            "paramValue": "fsEventTracking",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "fsDocEvent2",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://developer.fullstory.com/browser/capture-events/analytics-events/\"\u003e✅ Analytics Event Documentation Link\u003c/a\u003e\u003c/strong\u003e",
        "enablingConditions": [
          {
            "paramName": "fsTagType",
            "paramValue": "fsEventTracking",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "fsDocSetPageProperties",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://developer.fullstory.com/browser/set-page-properties/\"\u003e📄 Set Page Properties Documentation Link\u003c/a\u003e\u003c/strong\u003e",
        "enablingConditions": [
          {
            "paramName": "fsTagType",
            "paramValue": "fsSetPageProperties",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "fsDocSetUserProperties",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://developer.fullstory.com/browser/identification/set-user-properties/\"\u003e👥 Set User Properties Documentation Link\u003c/a\u003e\u003c/strong\u003e",
        "enablingConditions": [
          {
            "paramName": "fsTagType",
            "paramValue": "fsSetUserProperties",
            "type": "EQUALS"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const createArgumentsQueue = require('createArgumentsQueue');
const makeString = require('makeString');
const makeTableMap = require('makeTableMap');
const getType = require('getType');
const logToConsole = require('logToConsole');

const FS = createArgumentsQueue('FS', 'FS.q');
const tagType = data.fsTagType;

if (tagType === 'fsEventTracking') {
  const eventName = makeString(data.fsEventName);
  if (!eventName) {
    return;
  }
  const eventProperties = getType(data.fsEventPropValue) === 'array' ? makeTableMap(data.fsEventPropValue, 'fsEventPropertyKey', 'fsEventPropertyValue') : {};
  FS('trackEvent', { name: eventName, properties: eventProperties });
  logToConsole('FullStory Event Tracked:', { name: eventName, properties: eventProperties });
} else if (tagType === 'fsIdentify') {
  const userId = makeString(data.fsUserIdSource);
  if (!userId) {
    return;
  }
  const userProperties = getType(data.fsUserIdCustomizer) === 'array' ? makeTableMap(data.fsUserIdCustomizer, 'fsIdentifierType', 'fsUserMetaDataValue') : {};
  FS('setIdentity', { uid: userId, properties: userProperties });
  logToConsole('FullStory User Identified:', { uid: userId, properties: userProperties });
} else if (tagType === 'fsSetPageProperties') {
  const pageProperties = getType(data.fsPagePropertyValue) === 'array' ? makeTableMap(data.fsPagePropertyValue, 'fsPagePropKey', 'fsPagePropValue') : {};
  FS('setProperties', { type: 'page', properties: pageProperties });
  logToConsole('FullStory Page Properties Set:', { type: 'page', properties: pageProperties });
} else if (tagType === 'fsSetUserProperties') {
  const userProperties = getType(data.fsUserPropertyValue) === 'array' ? makeTableMap(data.fsUserPropertyValue, 'fsSetUserPropKey', 'fsSetUserPropValue') : {};
  FS('setProperties', { type: 'user', properties: userProperties });
  logToConsole('FullStory User Properties Set:', { type: 'user', properties: userProperties });
}

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "FS"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "FS.q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Quick Test
  code: runCode();
setup: ''


___NOTES___

Created on 3/1/2025, 4:06:51 PM


